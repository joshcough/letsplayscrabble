// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Argonaut_Decode_Class from "../Data.Argonaut.Decode.Class/index.js";
import * as Data_Argonaut_Decode_Combinators from "../Data.Argonaut.Decode.Combinators/index.js";
import * as Data_Argonaut_Decode_Error from "../Data.Argonaut.Decode.Error/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Domain_Types from "../Domain.Types/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Console from "../Effect.Console/index.js";
import * as Effect_Exception from "../Effect.Exception/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var decodeJson = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeJson(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeForeignObject(Data_Argonaut_Decode_Class.decodeJsonJson));
var getField = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonBoolean);
var gDecodeJsonCons = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Data_Argonaut_Decode_Class.decodeJsonBoolean));
var gDecodeJsonCons1 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Domain_Types.decodeJsonPlayerId));
var gDecodeJsonCons2 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(Data_Argonaut_Decode_Class.decodeJsonInt));
var gDecodeJsonCons3 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Data_Argonaut_Decode_Class.decodeJsonInt));
var gDecodeJsonCons4 = /* #__PURE__ */ gDecodeJsonCons3(Data_Argonaut_Decode_Class.gDecodeJsonNil);
var idIsSymbol = {
    reflectSymbol: function () {
        return "id";
    }
};
var gDecodeJsonCons5 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(Data_Argonaut_Decode_Class.decodeJsonString));
var gDecodeJsonCons6 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Data_Argonaut_Decode_Class.decodeJsonString));
var playeridIsSymbol = {
    reflectSymbol: function () {
        return "playerid";
    }
};
var nameIsSymbol = {
    reflectSymbol: function () {
        return "name";
    }
};
var gDecodeJsonCons7 = /* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons4({
    reflectSymbol: function () {
        return "score";
    }
})()())({
    reflectSymbol: function () {
        return "position";
    }
})()())(playeridIsSymbol)()())({
    reflectSymbol: function () {
        return "oldrating";
    }
})()())({
    reflectSymbol: function () {
        return "newrating";
    }
})()())(nameIsSymbol)()())()));
var dateIsSymbol = {
    reflectSymbol: function () {
        return "date";
    }
};
var divisionIsSymbol = {
    reflectSymbol: function () {
        return "division";
    }
};
var cityIsSymbol = {
    reflectSymbol: function () {
        return "city";
    }
};
var getField1 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeArray(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Domain_Types.decodeJsonGameId))(/* #__PURE__ */ gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(Domain_Types.decodeJsonPairingId))(/* #__PURE__ */ gDecodeJsonCons1(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons1(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons4({
    reflectSymbol: function () {
        return "roundNumber";
    }
})()())({
    reflectSymbol: function () {
        return "player2Score";
    }
})()())({
    reflectSymbol: function () {
        return "player2Id";
    }
})()())({
    reflectSymbol: function () {
        return "player1Score";
    }
})()())({
    reflectSymbol: function () {
        return "player1Id";
    }
})()())({
    reflectSymbol: function () {
        return "pairingId";
    }
})()())({
    reflectSymbol: function () {
        return "isBye";
    }
})()())(idIsSymbol)()())())))(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeArray(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons7(/* #__PURE__ */ gDecodeJsonCons7(/* #__PURE__ */ gDecodeJsonCons5(Data_Argonaut_Decode_Class.gDecodeJsonNil)({
    reflectSymbol: function () {
        return "tourneyname";
    }
})()())({
    reflectSymbol: function () {
        return "player2";
    }
})()())({
    reflectSymbol: function () {
        return "player1";
    }
})()())({
    reflectSymbol: function () {
        return "gameid";
    }
})()())(dateIsSymbol)()())({
    reflectSymbol: function () {
        return "annotated";
    }
})()())())))(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Domain_Types.decodeJsonDivisionId))(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeArray(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons1(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeArray(Data_Argonaut_Decode_Class.decodeJsonInt)))(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeArray(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons3(/* #__PURE__ */ gDecodeJsonCons4({
    reflectSymbol: function () {
        return "wins";
    }
})()())({
    reflectSymbol: function () {
        return "tourneyid";
    }
})()())({
    reflectSymbol: function () {
        return "totalplayers";
    }
})()())({
    reflectSymbol: function () {
        return "ties";
    }
})()())({
    reflectSymbol: function () {
        return "ratingchange";
    }
})()())({
    reflectSymbol: function () {
        return "rating";
    }
})()())({
    reflectSymbol: function () {
        return "points";
    }
})()())({
    reflectSymbol: function () {
        return "place";
    }
})()())(nameIsSymbol)()())({
    reflectSymbol: function () {
        return "losses";
    }
})()())(divisionIsSymbol)()())(dateIsSymbol)()())({
    reflectSymbol: function () {
        return "averagepoints";
    }
})()())())))(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(/* #__PURE__ */ gDecodeJsonCons2(Data_Argonaut_Decode_Class.gDecodeJsonNil)({
    reflectSymbol: function () {
        return "w";
    }
})()())({
    reflectSymbol: function () {
        return "twlrating";
    }
})()())({
    reflectSymbol: function () {
        return "twlranking";
    }
})()())({
    reflectSymbol: function () {
        return "tournamentCount";
    }
})()())({
    reflectSymbol: function () {
        return "t";
    }
})()())({
    reflectSymbol: function () {
        return "state";
    }
})()())({
    reflectSymbol: function () {
        return "results";
    }
})()())(playeridIsSymbol)()())({
    reflectSymbol: function () {
        return "photourl";
    }
})()())({
    reflectSymbol: function () {
        return "opponentAverageScore";
    }
})()())(nameIsSymbol)()())({
    reflectSymbol: function () {
        return "l";
    }
})()())({
    reflectSymbol: function () {
        return "cswrating";
    }
})()())({
    reflectSymbol: function () {
        return "cswranking";
    }
})()())({
    reflectSymbol: function () {
        return "country";
    }
})()())(cityIsSymbol)()())({
    reflectSymbol: function () {
        return "b";
    }
})()())({
    reflectSymbol: function () {
        return "averageScore";
    }
})()())()))(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldMaybe(Domain_Types.decodeJsonXTId))(Data_Argonaut_Decode_Class.gDecodeJsonNil)({
    reflectSymbol: function () {
        return "xtid";
    }
})()())({
    reflectSymbol: function () {
        return "xtData";
    }
})()())({
    reflectSymbol: function () {
        return "seed";
    }
})()())({
    reflectSymbol: function () {
        return "ratingsHistory";
    }
})()())({
    reflectSymbol: function () {
        return "photo";
    }
})()())(nameIsSymbol)()())({
    reflectSymbol: function () {
        return "initialRating";
    }
})()())(idIsSymbol)()())())))(Data_Argonaut_Decode_Class.gDecodeJsonNil)({
    reflectSymbol: function () {
        return "players";
    }
})()())(nameIsSymbol)()())(idIsSymbol)()())({
    reflectSymbol: function () {
        return "headToHeadGames";
    }
})()())({
    reflectSymbol: function () {
        return "games";
    }
})()())()))(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeRecord(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ Data_Argonaut_Decode_Class.gDecodeJsonCons(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeFieldId(Domain_Types.decodeJsonTournamentId))(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons5(/* #__PURE__ */ gDecodeJsonCons6(/* #__PURE__ */ gDecodeJsonCons(/* #__PURE__ */ gDecodeJsonCons4({
    reflectSymbol: function () {
        return "year";
    }
})()())({
    reflectSymbol: function () {
        return "transparentBackground";
    }
})()())({
    reflectSymbol: function () {
        return "theme";
    }
})()())({
    reflectSymbol: function () {
        return "pollUntil";
    }
})()())(nameIsSymbol)()())({
    reflectSymbol: function () {
        return "longFormName";
    }
})()())({
    reflectSymbol: function () {
        return "lexicon";
    }
})()())(idIsSymbol)()())({
    reflectSymbol: function () {
        return "dataUrl";
    }
})()())(cityIsSymbol)()())()))(Data_Argonaut_Decode_Class.gDecodeJsonNil)({
    reflectSymbol: function () {
        return "tournament";
    }
})()())(divisionIsSymbol)()())());
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var fetchTournamentData = function (userId) {
    return function (v) {
        return function (maybeDivisionId) {
            var decodeApiResponse = function (json) {
                return bind(decodeJson(json))(function (obj) {
                    return bind(getField(obj)("success"))(function (success) {
                        if (success) {
                            return getField1(obj)("data");
                        };
                        return new Data_Either.Left(new Data_Argonaut_Decode_Error.TypeMismatch("API returned success: false"));
                    });
                });
            };
            var buildUrl = function (v1) {
                return function (v2) {
                    return function (v3) {
                        if (v3 instanceof Data_Maybe.Nothing) {
                            return "http://localhost:3001/api/public/users/" + (show(v1) + ("/tournaments/" + show(v2)));
                        };
                        if (v3 instanceof Data_Maybe.Just) {
                            return "http://localhost:3001/api/public/users/" + (show(v1) + ("/tournaments/" + (show(v2) + ("/divisions/" + show(v3.value0)))));
                        };
                        throw new Error("Failed pattern match at Api.TournamentApi (line 46, column 5 - line 46, column 57): " + [ v1.constructor.name, v2.constructor.name, v3.constructor.name ]);
                    };
                };
            };
            var url = buildUrl(userId)(v)(maybeDivisionId);
            return discard1(liftEffect(Effect_Console.log("[TournamentApi] Fetching from: " + url)))(function () {
                return bind1(Effect_Aff.makeAff(function (cb) {
                    return function __do() {
                        $foreign.fetchJsonImpl(url)(function (j) {
                            return cb(new Data_Either.Right(j));
                        })(function (err) {
                            return cb(new Data_Either.Left(Effect_Exception.error(err)));
                        })();
                        return Effect_Aff.nonCanceler;
                    };
                }))(function (json) {
                    return discard1(liftEffect(Effect_Console.log("[TournamentApi] Received response, decoding...")))(function () {
                        var v1 = decodeApiResponse(json);
                        if (v1 instanceof Data_Either.Left) {
                            return discard1(liftEffect(Effect_Console.log("[TournamentApi] Decode error: " + Data_Argonaut_Decode_Error.printJsonDecodeError(v1.value0))))(function () {
                                return pure1(new Data_Either.Left("Failed to decode response: " + Data_Argonaut_Decode_Error.printJsonDecodeError(v1.value0)));
                            });
                        };
                        if (v1 instanceof Data_Either.Right) {
                            return discard1(liftEffect(Effect_Console.log("[TournamentApi] Successfully decoded response")))(function () {
                                return pure1(new Data_Either.Right(v1.value0));
                            });
                        };
                        throw new Error("Failed pattern match at Api.TournamentApi (line 37, column 3 - line 43, column 25): " + [ v1.constructor.name ]);
                    });
                });
            });
        };
    };
};
export {
    fetchJsonImpl
} from "./foreign.js";
export {
    fetchTournamentData
};

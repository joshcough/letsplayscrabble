// Generated by purs version 0.15.15
import * as BroadcastChannel_Class from "../BroadcastChannel.Class/index.js";
import * as BroadcastChannel_MonadBroadcast from "../BroadcastChannel.MonadBroadcast/index.js";
import * as BroadcastChannel_MonadEmitters from "../BroadcastChannel.MonadEmitters/index.js";
import * as CSS_Class from "../CSS.Class/index.js";
import * as Config_Themes from "../Config.Themes/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Halogen_Subscription from "../Halogen.Subscription/index.js";
import * as Stats_OverlayLogic from "../Stats.OverlayLogic/index.js";
import * as Utils_CSS from "../Utils.CSS/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var $$void = /* #__PURE__ */ Data_Functor["void"](Halogen_Query_HalogenM.functorHalogenM);
var mapFlipped = /* #__PURE__ */ Data_Functor.mapFlipped(Halogen_Subscription.functorEmitter);
var gets = /* #__PURE__ */ Control_Monad_State_Class.gets(Halogen_Query_HalogenM.monadStateHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var HandleTournamentData = /* #__PURE__ */ (function () {
    function HandleTournamentData(value0) {
        this.value0 = value0;
    };
    HandleTournamentData.create = function (value0) {
        return new HandleTournamentData(value0);
    };
    return HandleTournamentData;
})();
var HandleAdminPanelUpdate = /* #__PURE__ */ (function () {
    function HandleAdminPanelUpdate(value0) {
        this.value0 = value0;
    };
    HandleAdminPanelUpdate.create = function (value0) {
        return new HandleAdminPanelUpdate(value0);
    };
    return HandleAdminPanelUpdate;
})();
var renderLoading = /* #__PURE__ */ (function () {
    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyCenter.value), Utils_CSS.cls(CSS_Class.HScreen.value) ]) ])([ Halogen_HTML_Core.text("Loading...") ]);
})();
var renderError = function (err) {
    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyCenter.value), Utils_CSS.cls(CSS_Class.HScreen.value), Utils_CSS.cls(CSS_Class.TextRed600.value) ]) ])([ Halogen_HTML_Core.text("Error: " + err) ]);
};
var renderWithData = function (v) {
    return function (v1) {
        if (v.loading) {
            return renderLoading;
        };
        if (Data_Boolean.otherwise) {
            return Data_Maybe.maybe(renderError(Data_Maybe.fromMaybe("No tournament data")(v.error)))(v1)(v.currentData);
        };
        throw new Error("Failed pattern match at Component.Overlay.BaseOverlay (line 140, column 1 - line 140, column 102): " + [ v.constructor.name, v1.constructor.name ]);
    };
};
var initialize = function (dictMonadAff) {
    var monadAffHalogenM = Halogen_Query_HalogenM.monadAffHalogenM(dictMonadAff);
    var subscribeTournamentData = BroadcastChannel_MonadEmitters.subscribeTournamentData(monadAffHalogenM);
    var subscribeAdminPanel = BroadcastChannel_MonadEmitters.subscribeAdminPanel(monadAffHalogenM);
    var postSubscribe = BroadcastChannel_Class.postSubscribe(monadAffHalogenM);
    return function (dictMonadBroadcast) {
        var postSubscribe1 = postSubscribe(BroadcastChannel_MonadBroadcast.monadBroadcastHalogenM(dictMonadBroadcast));
        return function (dictMonadEmitters) {
            var monadEmittersHalogenM = BroadcastChannel_MonadEmitters.monadEmittersHalogenM(dictMonadEmitters);
            var subscribeAdminPanel1 = subscribeAdminPanel(monadEmittersHalogenM);
            return bind(subscribeTournamentData(monadEmittersHalogenM))(function (tournamentDataEmitter) {
                return discard($$void(Halogen_Query_HalogenM.subscribe(mapFlipped(tournamentDataEmitter)(HandleTournamentData.create))))(function () {
                    return bind(subscribeAdminPanel1)(function (adminPanelEmitter) {
                        return discard($$void(Halogen_Query_HalogenM.subscribe(mapFlipped(adminPanelEmitter)(HandleAdminPanelUpdate.create))))(function () {
                            return bind(gets(function (v) {
                                return v.input;
                            }))(function (input) {
                                return postSubscribe1(Stats_OverlayLogic.buildSubscribeMessage(input.userId)(input.subscription));
                            });
                        });
                    });
                });
            });
        };
    };
};
var initialState = function (input) {
    return {
        currentData: Data_Maybe.Nothing.value,
        loading: true,
        error: Data_Maybe.Nothing.value,
        theme: Config_Themes.getTheme("scrabble"),
        input: input,
        subscription: input.subscription,
        currentMatch: Data_Maybe.Nothing.value,
        extra: input.extra
    };
};
var handleTournamentDataUpdate = function (response) {
    return function (v) {
        if (!Stats_OverlayLogic.shouldAcceptResponse(v.subscription)(response)) {
            return v;
        };
        if (Data_Boolean.otherwise) {
            var v1 = Stats_OverlayLogic.processTournamentDataResponse(v.subscription)(v.currentMatch)(response);
            if (v1 instanceof Data_Either.Left) {
                return {
                    currentData: v.currentData,
                    theme: v.theme,
                    input: v.input,
                    subscription: v.subscription,
                    currentMatch: v.currentMatch,
                    extra: v.extra,
                    error: new Data_Maybe.Just(v1.value0),
                    loading: false
                };
            };
            if (v1 instanceof Data_Either.Right) {
                return {
                    input: v.input,
                    subscription: v.subscription,
                    currentMatch: v.currentMatch,
                    extra: v.extra,
                    currentData: new Data_Maybe.Just(v1.value0.divisionScopedData),
                    theme: v1.value0.theme,
                    loading: false,
                    error: Data_Maybe.Nothing.value
                };
            };
            throw new Error("Failed pattern match at Component.Overlay.BaseOverlay (line 80, column 17 - line 88, column 12): " + [ v1.constructor.name ]);
        };
        throw new Error("Failed pattern match at Component.Overlay.BaseOverlay (line 73, column 1 - line 77, column 17): " + [ response.constructor.name, v.constructor.name ]);
    };
};
var handleAdminPanelUpdateState = function (update) {
    return function (v) {
        if (Stats_OverlayLogic.shouldProcessAdminUpdate(v.subscription)) {
            return {
                currentData: v.currentData,
                loading: v.loading,
                error: v.error,
                theme: v.theme,
                input: v.input,
                subscription: v.subscription,
                extra: v.extra,
                currentMatch: new Data_Maybe.Just(Stats_OverlayLogic.createCurrentMatchInfo(update))
            };
        };
        if (Data_Boolean.otherwise) {
            return v;
        };
        throw new Error("Failed pattern match at Component.Overlay.BaseOverlay (line 92, column 1 - line 96, column 17): " + [ update.constructor.name, v.constructor.name ]);
    };
};
var handleAction = function (dictMonadAff) {
    var initialize1 = initialize(dictMonadAff);
    return function (dictMonadBroadcast) {
        var initialize2 = initialize1(dictMonadBroadcast);
        return function (dictMonadEmitters) {
            var initialize3 = initialize2(dictMonadEmitters);
            return function (v) {
                if (v instanceof Initialize) {
                    return initialize3;
                };
                if (v instanceof HandleTournamentData) {
                    return modify_(handleTournamentDataUpdate(v.value0));
                };
                if (v instanceof HandleAdminPanelUpdate) {
                    return modify_(handleAdminPanelUpdateState(v.value0));
                };
                throw new Error("Failed pattern match at Component.Overlay.BaseOverlay (line 119, column 16 - line 122, column 82): " + [ v.constructor.name ]);
            };
        };
    };
};
var mkComponent = function (dictMonadAff) {
    var handleAction1 = handleAction(dictMonadAff);
    return function (dictMonadBroadcast) {
        var handleAction2 = handleAction1(dictMonadBroadcast);
        return function (dictMonadEmitters) {
            var handleAction3 = handleAction2(dictMonadEmitters);
            return function (renderFn) {
                return Halogen_Component.mkComponent({
                    initialState: initialState,
                    render: renderFn,
                    "eval": Halogen_Component.mkEval({
                        handleQuery: Halogen_Component.defaultEval.handleQuery,
                        receive: Halogen_Component.defaultEval.receive,
                        finalize: Halogen_Component.defaultEval.finalize,
                        handleAction: handleAction3,
                        initialize: new Data_Maybe.Just(Initialize.value)
                    })
                });
            };
        };
    };
};
export {
    Initialize,
    HandleTournamentData,
    HandleAdminPanelUpdate,
    initialState,
    handleTournamentDataUpdate,
    handleAdminPanelUpdateState,
    initialize,
    handleAction,
    renderLoading,
    renderError,
    renderWithData,
    mkComponent
};

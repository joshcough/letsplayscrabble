// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
import * as Halogen_Subscription from "../Halogen.Subscription/index.js";
import * as PubSub_Class from "../PubSub.Class/index.js";
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Effect.applicativeEffect)(Data_Foldable.foldableArray);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var InMemoryChannel = function (x) {
    return x;
};
var pubSubInMemoryChannel = {
    create: function (name) {
        return function __do() {
            var listeners = Effect_Ref["new"]([  ])();
            return {
                name: name,
                listeners: listeners
            };
        };
    },
    postMessage: function (v) {
        return function (message) {
            return function __do() {
                var listenerArray = Effect_Ref.read(v.listeners)();
                return traverse_(function (listener) {
                    return listener(message);
                })(listenerArray)();
            };
        };
    },
    subscribe: function (v) {
        return pure(Halogen_Subscription.makeEmitter(function (push) {
            return function __do() {
                Effect_Ref.modify_(function (v1) {
                    return append(v1)([ push ]);
                })(v.listeners)();
                return pure(Data_Unit.unit);
            };
        }));
    },
    close: function (v) {
        return Effect_Ref.write([  ])(v.listeners);
    }
};
var testChannel = /* #__PURE__ */ PubSub_Class.create(pubSubInMemoryChannel);
var simulateMessage = /* #__PURE__ */ PubSub_Class.postMessage(pubSubInMemoryChannel);
export {
    InMemoryChannel,
    testChannel,
    simulateMessage,
    pubSubInMemoryChannel
};

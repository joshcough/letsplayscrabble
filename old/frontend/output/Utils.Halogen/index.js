// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_Error_Class from "../Control.Monad.Error.Class/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Control_Monad_Trans_Class from "../Control.Monad.Trans.Class/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Effect_Exception from "../Effect.Exception/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var lift = /* #__PURE__ */ Control_Monad_Trans_Class.lift(Halogen_Query_HalogenM.monadTransHalogenM);
var withLoading = function (dictMonadError) {
    var lift1 = lift((dictMonadError.MonadThrow0()).Monad0());
    var $$try = Control_Monad_Error_Class["try"](dictMonadError);
    return function (action) {
        return function (onSuccess) {
            return discard(modify_(function (v) {
                var $13 = {};
                for (var $14 in v) {
                    if ({}.hasOwnProperty.call(v, $14)) {
                        $13[$14] = v[$14];
                    };
                };
                $13.loading = true;
                $13.error = Data_Maybe.Nothing.value;
                return $13;
            }))(function () {
                return bind(lift1($$try(action)))(function (result) {
                    if (result instanceof Data_Either.Left) {
                        return modify_(function (v) {
                            var $17 = {};
                            for (var $18 in v) {
                                if ({}.hasOwnProperty.call(v, $18)) {
                                    $17[$18] = v[$18];
                                };
                            };
                            $17.loading = false;
                            $17.error = new Data_Maybe.Just(Effect_Exception.message(result.value0));
                            return $17;
                        });
                    };
                    if (result instanceof Data_Either.Right) {
                        return discard(modify_(function (v) {
                            var $21 = {};
                            for (var $22 in v) {
                                if ({}.hasOwnProperty.call(v, $22)) {
                                    $21[$22] = v[$22];
                                };
                            };
                            $21.loading = false;
                            return $21;
                        }))(function () {
                            return onSuccess(result.value0);
                        });
                    };
                    throw new Error("Failed pattern match at Utils.Halogen (line 24, column 3 - line 29, column 22): " + [ result.constructor.name ]);
                });
            });
        };
    };
};
export {
    withLoading
};

// Generated by purs version 0.15.15
import * as API_CurrentMatch from "../API.CurrentMatch/index.js";
import * as Affjax from "../Affjax/index.js";
import * as Affjax_RequestHeader from "../Affjax.RequestHeader/index.js";
import * as Affjax_ResponseFormat from "../Affjax.ResponseFormat/index.js";
import * as Affjax_Web from "../Affjax.Web/index.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Argonaut_Decode_Class from "../Data.Argonaut.Decode.Class/index.js";
import * as Data_Argonaut_Decode_Combinators from "../Data.Argonaut.Decode.Combinators/index.js";
import * as Data_Argonaut_Decode_Error from "../Data.Argonaut.Decode.Error/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_HTTP_Method from "../Data.HTTP.Method/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Utils_Logger from "../Utils.Logger/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var decodeJson = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeJson(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeForeignObject(Data_Argonaut_Decode_Class.decodeJsonJson));
var getField = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonBoolean);
var getField1 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonJson);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var fetchTournamentData = function (userId) {
    return function (v) {
        return function (maybeDivisionName) {
            var decodeApiResponse = function (json) {
                return bind(decodeJson(json))(function (obj) {
                    return bind(getField(obj)("success"))(function (success) {
                        if (success) {
                            return bind(getField1(obj)("data"))(function (dataJson) {
                                var v1 = API_CurrentMatch.decodeTournament(dataJson);
                                if (v1 instanceof Data_Either.Left) {
                                    return new Data_Either.Left(new Data_Argonaut_Decode_Error.TypeMismatch("Failed to decode Tournament: " + v1.value0));
                                };
                                if (v1 instanceof Data_Either.Right) {
                                    return new Data_Either.Right(v1.value0);
                                };
                                throw new Error("Failed pattern match at Api.TournamentApi (line 64, column 11 - line 66, column 49): " + [ v1.constructor.name ]);
                            });
                        };
                        return new Data_Either.Left(new Data_Argonaut_Decode_Error.TypeMismatch("API returned success: false"));
                    });
                });
            };
            var buildUrl = function (uid) {
                return function (tid) {
                    return function (v1) {
                        return "http://localhost:3001/api/public/users/" + (show(uid) + ("/tournaments/" + show(tid)));
                    };
                };
            };
            var url = buildUrl(userId)(v)(maybeDivisionName);
            return bind1(Affjax_Web.request({
                content: Affjax.defaultRequest.content,
                username: Affjax.defaultRequest.username,
                password: Affjax.defaultRequest.password,
                timeout: Affjax.defaultRequest.timeout,
                url: url,
                method: new Data_Either.Left(Data_HTTP_Method.GET.value),
                responseFormat: Affjax_ResponseFormat.json,
                headers: [ new Affjax_RequestHeader.RequestHeader("Content-Type", "application/json") ],
                withCredentials: true
            }))(function (result) {
                if (result instanceof Data_Either.Left) {
                    return discard(liftEffect(Utils_Logger.log("[TournamentApi] HTTP error: " + Affjax.printError(result.value0))))(function () {
                        return pure(new Data_Either.Left("HTTP error: " + Affjax.printError(result.value0)));
                    });
                };
                if (result instanceof Data_Either.Right) {
                    var v1 = decodeApiResponse(result.value0.body);
                    if (v1 instanceof Data_Either.Left) {
                        return discard(liftEffect(Utils_Logger.log("[TournamentApi] Decode error: " + Data_Argonaut_Decode_Error.printJsonDecodeError(v1.value0))))(function () {
                            return pure(new Data_Either.Left("Failed to decode response: " + Data_Argonaut_Decode_Error.printJsonDecodeError(v1.value0)));
                        });
                    };
                    if (v1 instanceof Data_Either.Right) {
                        return pure(new Data_Either.Right(v1.value0));
                    };
                    throw new Error("Failed pattern match at Api.TournamentApi (line 43, column 7 - line 48, column 29): " + [ v1.constructor.name ]);
                };
                throw new Error("Failed pattern match at Api.TournamentApi (line 37, column 3 - line 48, column 29): " + [ result.constructor.name ]);
            });
        };
    };
};
export {
    fetchTournamentData
};

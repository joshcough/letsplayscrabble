// Generated by purs version 0.15.15
import * as Affjax from "../Affjax/index.js";
import * as Affjax_ResponseFormat from "../Affjax.ResponseFormat/index.js";
import * as Affjax_StatusCode from "../Affjax.StatusCode/index.js";
import * as Affjax_Web from "../Affjax.Web/index.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Argonaut_Decode_Class from "../Data.Argonaut.Decode.Class/index.js";
import * as Data_Argonaut_Decode_Combinators from "../Data.Argonaut.Decode.Combinators/index.js";
import * as Data_Argonaut_Decode_Error from "../Data.Argonaut.Decode.Error/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Types_CurrentMatch from "../Types.CurrentMatch/index.js";
import * as Utils_Logger from "../Utils.Logger/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var decodeJson = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeJson(/* #__PURE__ */ Data_Argonaut_Decode_Class.decodeForeignObject(Data_Argonaut_Decode_Class.decodeJsonJson));
var getField = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonBoolean);
var getField1 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonJson);
var decodeJson1 = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeJson(Types_CurrentMatch.decodeJsonCurrentMatch);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var show1 = /* #__PURE__ */ Data_Show.show(Affjax_StatusCode.showStatusCode);
var decodeApiResponse = function (json) {
    return bind(decodeJson(json))(function (obj) {
        return bind(getField(obj)("success"))(function (success) {
            if (success) {
                return bind(getField1(obj)("data"))(function (dataJson) {
                    var v = decodeJson1(dataJson);
                    if (v instanceof Data_Either.Left) {
                        return new Data_Either.Right(Data_Maybe.Nothing.value);
                    };
                    if (v instanceof Data_Either.Right) {
                        return new Data_Either.Right(new Data_Maybe.Just(v.value0));
                    };
                    throw new Error("Failed pattern match at Api.CurrentMatchApi (line 60, column 7 - line 62, column 42): " + [ v.constructor.name ]);
                });
            };
            return new Data_Either.Right(Data_Maybe.Nothing.value);
        });
    });
};
var fetchCurrentMatch = function (userId) {
    var url = "http://localhost:3001/api/overlay/users/" + (show(userId) + "/match/current");
    return bind1(Affjax_Web.get(Affjax_ResponseFormat.json)(url))(function (affjaxResult) {
        if (affjaxResult instanceof Data_Either.Left) {
            var errMsg = Affjax.printError(affjaxResult.value0);
            return discard(liftEffect(Utils_Logger.log("[CurrentMatchApi] Network error: " + errMsg)))(function () {
                return pure(new Data_Either.Left("Network error: " + errMsg));
            });
        };
        if (affjaxResult instanceof Data_Either.Right) {
            if (affjaxResult.value0.status === 404) {
                return pure(new Data_Either.Right(Data_Maybe.Nothing.value));
            };
            if (affjaxResult.value0.status === 200) {
                var v = decodeApiResponse(affjaxResult.value0.body);
                if (v instanceof Data_Either.Left) {
                    var errMsg = Data_Argonaut_Decode_Error.printJsonDecodeError(v.value0);
                    return discard(liftEffect(Utils_Logger.log("[CurrentMatchApi] Decode error: " + errMsg)))(function () {
                        return pure(new Data_Either.Left(errMsg));
                    });
                };
                if (v instanceof Data_Either.Right) {
                    return pure(new Data_Either.Right(v.value0));
                };
                throw new Error("Failed pattern match at Api.CurrentMatchApi (line 39, column 11 - line 45, column 35): " + [ v.constructor.name ]);
            };
            return discard(liftEffect(Utils_Logger.log("[CurrentMatchApi] HTTP error: " + show1(affjaxResult.value0.status))))(function () {
                return pure(new Data_Either.Left("HTTP error: " + show1(affjaxResult.value0.status)));
            });
        };
        throw new Error("Failed pattern match at Api.CurrentMatchApi (line 27, column 3 - line 49, column 63): " + [ affjaxResult.constructor.name ]);
    });
};
export {
    fetchCurrentMatch,
    decodeApiResponse
};

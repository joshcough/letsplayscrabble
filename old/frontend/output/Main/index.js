// Generated by purs version 0.15.15
import * as AppM from "../AppM/index.js";
import * as BroadcastChannel_Manager from "../BroadcastChannel.Manager/index.js";
import * as Component_Router from "../Component.Router/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Halogen_Aff_Util from "../Halogen.Aff.Util/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_Query from "../Halogen.Query/index.js";
import * as Halogen_VDom_Driver from "../Halogen.VDom.Driver/index.js";
import * as Route from "../Route/index.js";
import * as Routing_Duplex from "../Routing.Duplex/index.js";
import * as Routing_Hash from "../Routing.Hash/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var hoist = /* #__PURE__ */ Halogen_Component.hoist(Effect_Aff.functorAff);
var component = /* #__PURE__ */ Component_Router.component(AppM.monadBackendAppM)(AppM.monadBroadcastAppM)(AppM.monadEmittersAppM)(AppM.monadAffAppM)(AppM.monadEffectAppM);
var $$void = /* #__PURE__ */ Data_Functor["void"](Effect_Aff.functorAff);
var matchesWith = /* #__PURE__ */ Routing_Hash.matchesWith(Data_Foldable.foldableEither);
var main = /* #__PURE__ */ Halogen_Aff_Util.runHalogenAff(/* #__PURE__ */ bind(Halogen_Aff_Util.awaitBody)(function (body) {
    return bind(liftEffect(BroadcastChannel_Manager.create))(function (v) {
        var env = {
            broadcastManager: v.broadcastManager,
            emitterManager: v.emitterManager
        };
        return bind(Halogen_VDom_Driver.runUI(hoist(AppM.runAppM(env))(component))(Data_Unit.unit)(body))(function (io) {
            return $$void(liftEffect(matchesWith(Routing_Duplex.parse(Route.routeCodec))(function (v1) {
                return function ($$new) {
                    return Effect_Aff.launchAff_($$void(io.query(Halogen_Query.mkTell(Component_Router.Navigate.create($$new)))));
                };
            })));
        });
    });
}));
export {
    main
};

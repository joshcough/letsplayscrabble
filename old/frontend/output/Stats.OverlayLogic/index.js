// Generated by purs version 0.15.15
import * as Config_Themes from "../Config.Themes/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Domain_Types from "../Domain.Types/index.js";
var show = /* #__PURE__ */ Data_Show.show(Domain_Types.showTournamentId);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showString);
var map = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var show2 = /* #__PURE__ */ Data_Show.show(/* #__PURE__ */ Data_Maybe.showMaybe(Data_Show.showString));
var eq2 = /* #__PURE__ */ Data_Eq.eq(Domain_Types.eqTournamentId);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var SpecificTournament = /* #__PURE__ */ (function () {
    function SpecificTournament(value0) {
        this.value0 = value0;
    };
    SpecificTournament.create = function (value0) {
        return new SpecificTournament(value0);
    };
    return SpecificTournament;
})();
var CurrentMatch = /* #__PURE__ */ (function () {
    function CurrentMatch() {

    };
    CurrentMatch.value = new CurrentMatch();
    return CurrentMatch;
})();
var showTournamentSubscription = {
    show: function (v) {
        if (v instanceof CurrentMatch) {
            return "CurrentMatch";
        };
        if (v instanceof SpecificTournament) {
            return "SpecificTournament { tournamentId: " + (show(v.value0.tournamentId) + (", divisionName: " + (show1(v.value0.divisionName) + " }")));
        };
        throw new Error("Failed pattern match at Stats.OverlayLogic (line 26, column 1 - line 29, column 114): " + [ v.constructor.name ]);
    }
};
var shouldProcessAdminUpdate = function (subscription) {
    if (subscription instanceof CurrentMatch) {
        return true;
    };
    if (subscription instanceof SpecificTournament) {
        return false;
    };
    throw new Error("Failed pattern match at Stats.OverlayLogic (line 155, column 3 - line 157, column 34): " + [ subscription.constructor.name ]);
};
var shouldAcceptResponse = function (subscription) {
    return function (response) {
        if (subscription instanceof CurrentMatch) {
            return response.isCurrentMatch;
        };
        if (subscription instanceof SpecificTournament) {
            return subscription.value0.tournamentId === response.tournamentId;
        };
        throw new Error("Failed pattern match at Stats.OverlayLogic (line 67, column 3 - line 72, column 28): " + [ subscription.constructor.name ]);
    };
};
var resolveDivisionName = function (subscription) {
    return function (currentMatch) {
        if (subscription instanceof CurrentMatch) {
            return map(function (v) {
                return v.divisionName;
            })(currentMatch);
        };
        if (subscription instanceof SpecificTournament) {
            return new Data_Maybe.Just(subscription.value0.divisionName);
        };
        throw new Error("Failed pattern match at Stats.OverlayLogic (line 87, column 3 - line 89, column 61): " + [ subscription.constructor.name ]);
    };
};
var formatDivisionNotFoundError = function (divisionName) {
    return "Division not found: " + show2(divisionName);
};
var findDivisionByName = function (name) {
    return function (divisions) {
        return Data_Array.find(function (d) {
            return d.name === name;
        })(divisions);
    };
};
var eqTournamentSubscription = {
    eq: function (x) {
        return function (y) {
            if (x instanceof SpecificTournament && y instanceof SpecificTournament) {
                return x.value0.divisionName === y.value0.divisionName && eq2(x.value0.tournamentId)(y.value0.tournamentId);
            };
            if (x instanceof CurrentMatch && y instanceof CurrentMatch) {
                return true;
            };
            return false;
        };
    }
};
var createTournamentSummary = function (tournament) {
    return {
        id: tournament.id,
        name: tournament.name,
        city: tournament.city,
        year: tournament.year,
        lexicon: tournament.lexicon,
        longFormName: tournament.longFormName,
        dataUrl: tournament.dataUrl,
        pollUntil: Data_Maybe.Nothing.value,
        theme: tournament.theme,
        transparentBackground: tournament.transparentBackground
    };
};
var createTournamentSubscription = function (maybeTournamentId) {
    return function (maybeDivisionName) {
        if (maybeTournamentId instanceof Data_Maybe.Just && maybeDivisionName instanceof Data_Maybe.Just) {
            return new Data_Maybe.Just(new SpecificTournament({
                tournamentId: maybeTournamentId.value0,
                divisionName: maybeDivisionName.value0
            }));
        };
        if (maybeTournamentId instanceof Data_Maybe.Nothing && maybeDivisionName instanceof Data_Maybe.Nothing) {
            return new Data_Maybe.Just(CurrentMatch.value);
        };
        return Data_Maybe.Nothing.value;
    };
};
var createDivisionScopedData = function (tournament) {
    return function (division) {
        return {
            tournament: tournament,
            division: division
        };
    };
};
var processTournamentDataResponse = function (subscription) {
    return function (currentMatch) {
        return function (response) {
            var divisionName = resolveDivisionName(subscription)(currentMatch);
            var division = bind(divisionName)(function (name) {
                return findDivisionByName(name)(response.data.divisions);
            });
            if (division instanceof Data_Maybe.Nothing) {
                return new Data_Either.Left(formatDivisionNotFoundError(divisionName));
            };
            if (division instanceof Data_Maybe.Just) {
                var tournamentSummary = createTournamentSummary(response.data);
                var theme = Config_Themes.getTheme(response.data.theme);
                var divisionScopedData = createDivisionScopedData(tournamentSummary)(division.value0);
                return new Data_Either.Right({
                    divisionScopedData: divisionScopedData,
                    theme: theme,
                    divisionName: division.value0.name
                });
            };
            throw new Error("Failed pattern match at Stats.OverlayLogic (line 188, column 5 - line 207, column 14): " + [ division.constructor.name ]);
        };
    };
};
var createCurrentMatchInfo = function (update) {
    return {
        tournamentId: update.tournamentId,
        round: update.round,
        pairingId: update.pairingId,
        divisionName: update.divisionName
    };
};
var buildSubscribeMessage = function (userId) {
    return function (subscription) {
        if (subscription instanceof CurrentMatch) {
            return {
                userId: userId,
                tournament: Data_Maybe.Nothing.value
            };
        };
        if (subscription instanceof SpecificTournament) {
            return {
                userId: userId,
                tournament: new Data_Maybe.Just({
                    tournamentId: subscription.value0.tournamentId,
                    division: new Data_Maybe.Just({
                        divisionName: subscription.value0.divisionName
                    })
                })
            };
        };
        throw new Error("Failed pattern match at Stats.OverlayLogic (line 42, column 3 - line 53, column 8): " + [ subscription.constructor.name ]);
    };
};
export {
    SpecificTournament,
    CurrentMatch,
    createTournamentSubscription,
    buildSubscribeMessage,
    shouldAcceptResponse,
    resolveDivisionName,
    findDivisionByName,
    createTournamentSummary,
    createDivisionScopedData,
    formatDivisionNotFoundError,
    createCurrentMatchInfo,
    shouldProcessAdminUpdate,
    processTournamentDataResponse,
    eqTournamentSubscription,
    showTournamentSubscription
};

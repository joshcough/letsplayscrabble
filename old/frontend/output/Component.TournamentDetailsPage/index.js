// Generated by purs version 0.15.15
import * as Backend_MonadBackend from "../Backend.MonadBackend/index.js";
import * as CSS_Class from "../CSS.Class/index.js";
import * as CSS_ThemeColor from "../CSS.ThemeColor/index.js";
import * as Component_ThemeSelector from "../Component.ThemeSelector/index.js";
import * as Config_Themes from "../Config.Themes/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as DOM_HTML_Indexed_InputType from "../DOM.HTML.Indexed.InputType/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_JSDate from "../Data.JSDate/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Unsafe from "../Effect.Unsafe/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Utils_Auth from "../Utils.Auth/index.js";
import * as Utils_CSS from "../Utils.CSS/index.js";
import * as Utils_Halogen from "../Utils.Halogen/index.js";
import * as Utils_Logger from "../Utils.Logger/index.js";
var type_ = /* #__PURE__ */ Halogen_HTML_Properties.type_(Halogen_HTML_Core.isPropInputType);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var for_ = /* #__PURE__ */ Data_Foldable.for_(Halogen_Query_HalogenM.applicativeHalogenM)(Data_Foldable.foldableMaybe);
var join = /* #__PURE__ */ Control_Bind.join(Control_Bind.bindArray);
var NavigateBack = /* #__PURE__ */ (function () {
    function NavigateBack() {

    };
    NavigateBack.value = new NavigateBack();
    return NavigateBack;
})();
var Name = /* #__PURE__ */ (function () {
    function Name() {

    };
    Name.value = new Name();
    return Name;
})();
var LongFormName = /* #__PURE__ */ (function () {
    function LongFormName() {

    };
    LongFormName.value = new LongFormName();
    return LongFormName;
})();
var City = /* #__PURE__ */ (function () {
    function City() {

    };
    City.value = new City();
    return City;
})();
var Year = /* #__PURE__ */ (function () {
    function Year() {

    };
    Year.value = new Year();
    return Year;
})();
var Lexicon = /* #__PURE__ */ (function () {
    function Lexicon() {

    };
    Lexicon.value = new Lexicon();
    return Lexicon;
})();
var ThemeField = /* #__PURE__ */ (function () {
    function ThemeField() {

    };
    ThemeField.value = new ThemeField();
    return ThemeField;
})();
var DataUrl = /* #__PURE__ */ (function () {
    function DataUrl() {

    };
    DataUrl.value = new DataUrl();
    return DataUrl;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var LoadTournament = /* #__PURE__ */ (function () {
    function LoadTournament() {

    };
    LoadTournament.value = new LoadTournament();
    return LoadTournament;
})();
var HandleBackClick = /* #__PURE__ */ (function () {
    function HandleBackClick() {

    };
    HandleBackClick.value = new HandleBackClick();
    return HandleBackClick;
})();
var HandleEditClick = /* #__PURE__ */ (function () {
    function HandleEditClick() {

    };
    HandleEditClick.value = new HandleEditClick();
    return HandleEditClick;
})();
var HandleSaveClick = /* #__PURE__ */ (function () {
    function HandleSaveClick() {

    };
    HandleSaveClick.value = new HandleSaveClick();
    return HandleSaveClick;
})();
var HandleCancelClick = /* #__PURE__ */ (function () {
    function HandleCancelClick() {

    };
    HandleCancelClick.value = new HandleCancelClick();
    return HandleCancelClick;
})();
var HandleFieldChange = /* #__PURE__ */ (function () {
    function HandleFieldChange(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleFieldChange.create = function (value0) {
        return function (value1) {
            return new HandleFieldChange(value0, value1);
        };
    };
    return HandleFieldChange;
})();
var HandlePollingDaysChange = /* #__PURE__ */ (function () {
    function HandlePollingDaysChange(value0) {
        this.value0 = value0;
    };
    HandlePollingDaysChange.create = function (value0) {
        return new HandlePollingDaysChange(value0);
    };
    return HandlePollingDaysChange;
})();
var HandleStartPolling = /* #__PURE__ */ (function () {
    function HandleStartPolling() {

    };
    HandleStartPolling.value = new HandleStartPolling();
    return HandleStartPolling;
})();
var HandleStopPolling = /* #__PURE__ */ (function () {
    function HandleStopPolling() {

    };
    HandleStopPolling.value = new HandleStopPolling();
    return HandleStopPolling;
})();
var HandleClearCache = /* #__PURE__ */ (function () {
    function HandleClearCache() {

    };
    HandleClearCache.value = new HandleClearCache();
    return HandleClearCache;
})();
var HandleRefetch = /* #__PURE__ */ (function () {
    function HandleRefetch() {

    };
    HandleRefetch.value = new HandleRefetch();
    return HandleRefetch;
})();
var HandleFullRefetch = /* #__PURE__ */ (function () {
    function HandleFullRefetch() {

    };
    HandleFullRefetch.value = new HandleFullRefetch();
    return HandleFullRefetch;
})();
var updateField = function (field) {
    return function (value1) {
        return function (form) {
            if (field instanceof Name) {
                return {
                    longFormName: form.longFormName,
                    city: form.city,
                    year: form.year,
                    lexicon: form.lexicon,
                    theme: form.theme,
                    dataUrl: form.dataUrl,
                    name: value1
                };
            };
            if (field instanceof LongFormName) {
                return {
                    name: form.name,
                    city: form.city,
                    year: form.year,
                    lexicon: form.lexicon,
                    theme: form.theme,
                    dataUrl: form.dataUrl,
                    longFormName: value1
                };
            };
            if (field instanceof City) {
                return {
                    name: form.name,
                    longFormName: form.longFormName,
                    year: form.year,
                    lexicon: form.lexicon,
                    theme: form.theme,
                    dataUrl: form.dataUrl,
                    city: value1
                };
            };
            if (field instanceof Year) {
                return {
                    name: form.name,
                    longFormName: form.longFormName,
                    city: form.city,
                    lexicon: form.lexicon,
                    theme: form.theme,
                    dataUrl: form.dataUrl,
                    year: value1
                };
            };
            if (field instanceof Lexicon) {
                return {
                    name: form.name,
                    longFormName: form.longFormName,
                    city: form.city,
                    year: form.year,
                    theme: form.theme,
                    dataUrl: form.dataUrl,
                    lexicon: value1
                };
            };
            if (field instanceof ThemeField) {
                return {
                    name: form.name,
                    longFormName: form.longFormName,
                    city: form.city,
                    year: form.year,
                    lexicon: form.lexicon,
                    dataUrl: form.dataUrl,
                    theme: value1
                };
            };
            if (field instanceof DataUrl) {
                return {
                    name: form.name,
                    longFormName: form.longFormName,
                    city: form.city,
                    year: form.year,
                    lexicon: form.lexicon,
                    theme: form.theme,
                    dataUrl: value1
                };
            };
            throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 295, column 32 - line 302, column 38): " + [ field.constructor.name ]);
        };
    };
};
var renderThemeSection = function (editing) {
    return function (currentTheme) {
        return function (themeName) {
            return function (selectedThemeId) {
                return [ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FontMedium.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.raw(currentTheme.colors.textSecondary), Utils_CSS.raw(currentTheme.colors.secondaryBorder) ]) ])([ Halogen_HTML_Core.text("Overlay Theme:") ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.cls(CSS_Class.ColSpan_1.value), Utils_CSS.raw(currentTheme.colors.secondaryBorder) ]) ])([ (function () {
                    if (editing) {
                        return Component_ThemeSelector.renderThemeSelector(selectedThemeId)(currentTheme)(HandleFieldChange.create(ThemeField.value));
                    };
                    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.raw(currentTheme.colors.textPrimary) ]) ])([ Halogen_HTML_Core.text(themeName) ]);
                })() ]) ];
            };
        };
    };
};
var renderFieldOrInput = function (editing) {
    return function (theme) {
        return function (label) {
            return function (value1) {
                return function (editValue) {
                    return function (field) {
                        return [ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FontMedium.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextSecondary.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ Halogen_HTML_Core.text(label + ":") ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ (function () {
                            if (editing) {
                                return Halogen_HTML_Elements.input([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.W_Full.value), Utils_CSS.cls(CSS_Class.Px_2.value), Utils_CSS.cls(CSS_Class.Py_1.value), Utils_CSS.cls(CSS_Class.Border.value), Utils_CSS.cls(CSS_Class.Rounded.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value) ]), type_(DOM_HTML_Indexed_InputType.InputText.value), value(editValue), Halogen_HTML_Events.onValueInput(HandleFieldChange.create(field)) ]);
                            };
                            return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value) ]) ])([ Halogen_HTML_Core.text(value1) ]);
                        })() ]) ];
                    };
                };
            };
        };
    };
};
var renderControlSection = function (theme) {
    return function (label) {
        return function (description) {
            return function (buttons) {
                return [ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FontMedium.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextSecondary.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ Halogen_HTML_Core.text(label + ":") ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyBetween.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value) ]) ])([ Halogen_HTML_Core.text(description) ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.Gap_2.value) ]) ])(buttons) ]) ];
            };
        };
    };
};
var handleLoadTournament = function (dictMonadBackend) {
    var withLoading = Utils_Halogen.withLoading(dictMonadBackend.MonadError0());
    var getTournamentRow = Backend_MonadBackend.getTournamentRow(dictMonadBackend);
    return function (dictMonadEffect) {
        var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadEffect));
        return bind(get)(function (state) {
            return Data_Maybe.maybe(modify_(function (v) {
                var $92 = {};
                for (var $93 in v) {
                    if ({}.hasOwnProperty.call(v, $93)) {
                        $92[$93] = v[$93];
                    };
                };
                $92.loading = false;
                $92.error = new Data_Maybe.Just("Not authenticated");
                return $92;
            }))(function (userId) {
                return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Loading tournament " + (show(state.tournamentId) + (" for user " + show(userId))))))(function () {
                    return withLoading(getTournamentRow(userId)(state.tournamentId))(function (tournament) {
                        return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Loaded tournament: " + tournament.name)))(function () {
                            return modify_(function (v) {
                                var $95 = {};
                                for (var $96 in v) {
                                    if ({}.hasOwnProperty.call(v, $96)) {
                                        $95[$96] = v[$96];
                                    };
                                };
                                $95.tournament = new Data_Maybe.Just(tournament);
                                return $95;
                            });
                        });
                    });
                });
            })(state.userId);
        });
    };
};
var handleEditClick = /* #__PURE__ */ bind(get)(function (state) {
    return for_(state.tournament)(function (t) {
        var editForm = {
            name: t.name,
            longFormName: t.longFormName,
            city: t.city,
            year: show(t.year),
            lexicon: t.lexicon,
            theme: t.theme,
            dataUrl: t.dataUrl
        };
        return modify_(function (v) {
            var $98 = {};
            for (var $99 in v) {
                if ({}.hasOwnProperty.call(v, $99)) {
                    $98[$99] = v[$99];
                };
            };
            $98.editing = true;
            $98.editForm = editForm;
            return $98;
        });
    });
});
var formatDateString = function (dateStr) {
    var dateResult = Effect_Unsafe.unsafePerformEffect(Data_JSDate.parse(dateStr));
    return Data_JSDate.toDateString(dateResult);
};
var renderPollingSection = function (theme) {
    return function (tournament) {
        return function (pollingDays) {
            return [ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FontMedium.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextSecondary.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ Halogen_HTML_Core.text("Auto-Update:") ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyBetween.value), Utils_CSS.cls(CSS_Class.Py_2.value), Utils_CSS.cls(CSS_Class.BorderT.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ]) ])([ (function () {
                if (tournament.pollUntil instanceof Data_Maybe.Just) {
                    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.Gap_4.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.TextGreen600.value) ]) ])([ Halogen_HTML_Core.text("Active until " + formatDateString(tournament.pollUntil.value0)) ]), Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Px_3.value), Utils_CSS.cls(CSS_Class.Py_1.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.cls(CSS_Class.BgRed_50.value), Utils_CSS.cls(CSS_Class.TextRed600.value), Utils_CSS.cls(CSS_Class.Rounded.value), Utils_CSS.hover("bg-red-100") ]), Halogen_HTML_Events.onClick(function (v) {
                        return HandleStopPolling.value;
                    }) ])([ Halogen_HTML_Core.text("Stop") ]) ]);
                };
                if (tournament.pollUntil instanceof Data_Maybe.Nothing) {
                    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.Gap_4.value) ]) ])([ Halogen_HTML_Elements.input([ type_(DOM_HTML_Indexed_InputType.InputNumber.value), Halogen_HTML_Properties.min(1.0), Halogen_HTML_Properties.max(30.0), value(show(pollingDays)), Utils_CSS.css([ Utils_CSS.cls(CSS_Class.W_16.value), Utils_CSS.cls(CSS_Class.Px_2.value), Utils_CSS.cls(CSS_Class.Py_1.value), Utils_CSS.cls(CSS_Class.Border.value), Utils_CSS.cls(CSS_Class.Rounded.value) ]), Halogen_HTML_Events.onValueInput(HandlePollingDaysChange.create) ]), Halogen_HTML_Elements.span([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.TextGray600.value) ]) ])([ Halogen_HTML_Core.text("days") ]), Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Px_3.value), Utils_CSS.cls(CSS_Class.Py_1.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.cls(CSS_Class.BgGreen_50.value), Utils_CSS.cls(CSS_Class.TextGreen600.value), Utils_CSS.cls(CSS_Class.Rounded.value), Utils_CSS.hover("bg-green-100") ]), Halogen_HTML_Events.onClick(function (v) {
                        return HandleStartPolling.value;
                    }) ])([ Halogen_HTML_Core.text("Start") ]) ]);
                };
                throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 232, column 9 - line 266, column 16): " + [ tournament.pollUntil.constructor.name ]);
            })(), Halogen_HTML_Elements.div([  ])([  ]) ]) ];
        };
    };
};
var renderTournamentDetails = function (editing) {
    return function (editForm) {
        return function (theme) {
            return function (tournament) {
                return function (pollingDays) {
                    var tournamentTheme = Config_Themes.getTheme(tournament.theme);
                    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Grid.value), Utils_CSS.raw("grid-cols-[auto_1fr]"), Utils_CSS.cls(CSS_Class.Gap_X_4.value) ]) ])(join([ renderFieldOrInput(editing)(theme)("Name")(tournament.name)(editForm.name)(Name.value), renderFieldOrInput(editing)(theme)("Long Form Name")(tournament.longFormName)(editForm.longFormName)(LongFormName.value), renderFieldOrInput(editing)(theme)("City")(tournament.city)(editForm.city)(City.value), renderFieldOrInput(editing)(theme)("Year")(show(tournament.year))(editForm.year)(Year.value), renderFieldOrInput(editing)(theme)("Lexicon")(tournament.lexicon)(editForm.lexicon)(Lexicon.value), renderThemeSection(editing)(theme)(tournamentTheme.name)(editForm.theme), renderFieldOrInput(editing)(theme)("Data URL")(tournament.dataUrl)(editForm.dataUrl)(DataUrl.value), renderPollingSection(theme)(tournament)(pollingDays), renderControlSection(theme)("Cache")("Clear tournament cache across all browser tabs")([ Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.BtnSecondary.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.thm(theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.thm(theme)(CSS_ThemeColor.HoverBackground.value) ]), Halogen_HTML_Events.onClick(function (v) {
                        return HandleClearCache.value;
                    }) ])([ Halogen_HTML_Core.text("Clear Cache") ]) ]), renderControlSection(theme)("CrossTables")("Update player photos and data from CrossTables")([ Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.BtnSecondary.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.cls(CSS_Class.Mr_2.value), Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.thm(theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.thm(theme)(CSS_ThemeColor.HoverBackground.value) ]), Halogen_HTML_Events.onClick(function (v) {
                        return HandleRefetch.value;
                    }) ])([ Halogen_HTML_Core.text("Refetch") ]), Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.BtnSecondary.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.thm(theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.thm(theme)(CSS_ThemeColor.HoverBackground.value) ]), Halogen_HTML_Events.onClick(function (v) {
                        return HandleFullRefetch.value;
                    }) ])([ Halogen_HTML_Core.text("Full Refetch") ]) ]) ]));
                };
            };
        };
    };
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.MinHScreen.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.PageBackground.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.PageContainer.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(state.theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.cls(CSS_Class.P_6.value), Utils_CSS.cls(CSS_Class.RoundedLg.value), Utils_CSS.cls(CSS_Class.ShadowMd.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyBetween.value), Utils_CSS.cls(CSS_Class.Mb_4.value) ]) ])([ Halogen_HTML_Elements.h2([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.PageTitle.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.TextPrimary.value) ]) ])([ Halogen_HTML_Core.text(Data_Maybe.maybe("Tournament #" + show(state.tournamentId))(function (v) {
        return v.name;
    })(state.tournament)) ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.Gap_2.value) ]) ])([ (function () {
        if (state.editing) {
            return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.Gap_2.value) ]) ])([ Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.BtnSecondary.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.HoverBackground.value) ]), Halogen_HTML_Events.onClick(function (v) {
                return HandleSaveClick.value;
            }) ])([ Halogen_HTML_Core.text("Save") ]), Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.raw("btn-secondary"), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.hover("bg-gray-50") ]), Halogen_HTML_Events.onClick(function (v) {
                return HandleCancelClick.value;
            }) ])([ Halogen_HTML_Core.text("Cancel") ]) ]);
        };
        return Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.BtnSecondary.value), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.thm(state.theme)(CSS_ThemeColor.HoverBackground.value) ]), Halogen_HTML_Events.onClick(function (v) {
            return HandleEditClick.value;
        }) ])([ Halogen_HTML_Core.text("Edit") ]);
    })(), Halogen_HTML_Elements.button([ Utils_CSS.css([ Utils_CSS.raw("btn-secondary"), Utils_CSS.cls(CSS_Class.Text_Sm.value), Utils_CSS.hover("bg-gray-50") ]), Halogen_HTML_Events.onClick(function (v) {
        return HandleBackClick.value;
    }) ])([ Halogen_HTML_Core.text("Back to List") ]) ]) ]), (function () {
        if (state.loading) {
            return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(state.theme)(CSS_ThemeColor.TextSecondary.value) ]) ])([ Halogen_HTML_Core.text("Loading tournament details...") ]);
        };
        if (state.error instanceof Data_Maybe.Just) {
            return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.TextRed600.value) ]) ])([ Halogen_HTML_Core.text(state.error.value0) ]);
        };
        if (state.error instanceof Data_Maybe.Nothing) {
            if (state.tournament instanceof Data_Maybe.Just) {
                return renderTournamentDetails(state.editing)(state.editForm)(state.theme)(state.tournament.value0)(state.pollingDays);
            };
            if (state.tournament instanceof Data_Maybe.Nothing) {
                return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(state.theme)(CSS_ThemeColor.TextSecondary.value) ]) ])([ Halogen_HTML_Core.text("Tournament not found") ]);
            };
            throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 173, column 30 - line 178, column 59): " + [ state.tournament.constructor.name ]);
        };
        throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 168, column 22 - line 178, column 59): " + [ state.error.constructor.name ]);
    })() ]) ]) ]);
};
var emptyEditForm = {
    name: "",
    longFormName: "",
    city: "",
    year: "",
    lexicon: "",
    theme: "",
    dataUrl: ""
};
var handleSaveClick = function (dictMonadBackend) {
    var withLoading = Utils_Halogen.withLoading(dictMonadBackend.MonadError0());
    var updateTournament = Backend_MonadBackend.updateTournament(dictMonadBackend);
    return function (dictMonadEffect) {
        var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadEffect));
        return bind(get)(function (state) {
            return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Save clicked")))(function () {
                var v = Data_Int.fromString(state.editForm.year);
                if (v instanceof Data_Maybe.Nothing) {
                    return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Invalid year value")))(function () {
                        return modify_(function (v1) {
                            var $110 = {};
                            for (var $111 in v1) {
                                if ({}.hasOwnProperty.call(v1, $111)) {
                                    $110[$111] = v1[$111];
                                };
                            };
                            $110.error = new Data_Maybe.Just("Year must be a valid number");
                            return $110;
                        });
                    });
                };
                if (v instanceof Data_Maybe.Just) {
                    var updateReq = {
                        name: state.editForm.name,
                        longFormName: state.editForm.longFormName,
                        city: state.editForm.city,
                        year: v.value0,
                        lexicon: state.editForm.lexicon,
                        theme: state.editForm.theme,
                        dataUrl: state.editForm.dataUrl
                    };
                    return withLoading(updateTournament(state.tournamentId)(updateReq))(function (tournament) {
                        return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Tournament updated: " + tournament.name)))(function () {
                            return modify_(function (v1) {
                                var $113 = {};
                                for (var $114 in v1) {
                                    if ({}.hasOwnProperty.call(v1, $114)) {
                                        $113[$114] = v1[$114];
                                    };
                                };
                                $113.editing = false;
                                $113.tournament = new Data_Maybe.Just(tournament);
                                $113.editForm = emptyEditForm;
                                return $113;
                            });
                        });
                    });
                };
                throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 417, column 3 - line 438, column 12): " + [ v.constructor.name ]);
            });
        });
    };
};
var handleStopPolling = function (dictMonadBackend) {
    var withLoading = Utils_Halogen.withLoading(dictMonadBackend.MonadError0());
    var stopPolling = Backend_MonadBackend.stopPolling(dictMonadBackend);
    return function (dictMonadEffect) {
        var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadEffect));
        return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Stop polling clicked")))(function () {
            return bind(get)(function (state) {
                return withLoading(stopPolling(state.tournamentId))(function (v) {
                    return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Polling stopped successfully")))(function () {
                        return handleAction(dictMonadBackend)(dictMonadEffect)(LoadTournament.value);
                    });
                });
            });
        });
    };
};
var handleStartPolling = function (dictMonadBackend) {
    var withLoading = Utils_Halogen.withLoading(dictMonadBackend.MonadError0());
    var enablePolling = Backend_MonadBackend.enablePolling(dictMonadBackend);
    return function (dictMonadEffect) {
        var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadEffect));
        return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Start polling clicked")))(function () {
            return bind(get)(function (state) {
                return withLoading(enablePolling(state.tournamentId)(state.pollingDays))(function (v) {
                    return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Polling started successfully")))(function () {
                        return handleAction(dictMonadBackend)(dictMonadEffect)(LoadTournament.value);
                    });
                });
            });
        });
    };
};
var handleAction = function (dictMonadBackend) {
    var handleLoadTournament1 = handleLoadTournament(dictMonadBackend);
    var handleSaveClick1 = handleSaveClick(dictMonadBackend);
    var withLoading = Utils_Halogen.withLoading(dictMonadBackend.MonadError0());
    var clearCache = Backend_MonadBackend.clearCache(dictMonadBackend);
    var refetchTournament = Backend_MonadBackend.refetchTournament(dictMonadBackend);
    var fullRefetchTournament = Backend_MonadBackend.fullRefetchTournament(dictMonadBackend);
    return function (dictMonadEffect) {
        var liftEffect = Effect_Class.liftEffect(Halogen_Query_HalogenM.monadEffectHalogenM(dictMonadEffect));
        var handleLoadTournament2 = handleLoadTournament1(dictMonadEffect);
        var handleSaveClick2 = handleSaveClick1(dictMonadEffect);
        return function (v) {
            if (v instanceof Initialize) {
                return bind(liftEffect(Utils_Auth.getUserId))(function (userId) {
                    return discard(modify_(function (v1) {
                        var $118 = {};
                        for (var $119 in v1) {
                            if ({}.hasOwnProperty.call(v1, $119)) {
                                $118[$119] = v1[$119];
                            };
                        };
                        $118.userId = userId;
                        return $118;
                    }))(function () {
                        return handleAction(dictMonadBackend)(dictMonadEffect)(LoadTournament.value);
                    });
                });
            };
            if (v instanceof LoadTournament) {
                return handleLoadTournament2;
            };
            if (v instanceof HandleBackClick) {
                return Halogen_Query_HalogenM.raise(NavigateBack.value);
            };
            if (v instanceof HandleEditClick) {
                return handleEditClick;
            };
            if (v instanceof HandleSaveClick) {
                return handleSaveClick2;
            };
            if (v instanceof HandleCancelClick) {
                return modify_(function (v1) {
                    var $121 = {};
                    for (var $122 in v1) {
                        if ({}.hasOwnProperty.call(v1, $122)) {
                            $121[$122] = v1[$122];
                        };
                    };
                    $121.editing = false;
                    $121.editForm = emptyEditForm;
                    return $121;
                });
            };
            if (v instanceof HandleFieldChange) {
                return modify_(function (s) {
                    var $124 = {};
                    for (var $125 in s) {
                        if ({}.hasOwnProperty.call(s, $125)) {
                            $124[$125] = s[$125];
                        };
                    };
                    $124.editForm = updateField(v.value0)(v.value1)(s.editForm);
                    return $124;
                });
            };
            if (v instanceof HandlePollingDaysChange) {
                return for_(Data_Int.fromString(v.value0))(function (days) {
                    return modify_(function (v1) {
                        var $129 = {};
                        for (var $130 in v1) {
                            if ({}.hasOwnProperty.call(v1, $130)) {
                                $129[$130] = v1[$130];
                            };
                        };
                        $129.pollingDays = days;
                        return $129;
                    });
                });
            };
            if (v instanceof HandleStartPolling) {
                return handleStartPolling(dictMonadBackend)(dictMonadEffect);
            };
            if (v instanceof HandleStopPolling) {
                return handleStopPolling(dictMonadBackend)(dictMonadEffect);
            };
            if (v instanceof HandleClearCache) {
                return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Clear cache clicked")))(function () {
                    return withLoading(clearCache)(function (v1) {
                        return liftEffect(Utils_Logger.log("[TournamentDetailsPage] Cache cleared successfully"));
                    });
                });
            };
            if (v instanceof HandleRefetch) {
                return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Refetch clicked")))(function () {
                    return bind(get)(function (state) {
                        return withLoading(refetchTournament(state.tournamentId))(function (message) {
                            return liftEffect(Utils_Logger.log("[TournamentDetailsPage] Refetch successful: " + message));
                        });
                    });
                });
            };
            if (v instanceof HandleFullRefetch) {
                return discard(liftEffect(Utils_Logger.log("[TournamentDetailsPage] Full refetch clicked")))(function () {
                    return bind(get)(function (state) {
                        return withLoading(fullRefetchTournament(state.tournamentId))(function (message) {
                            return liftEffect(Utils_Logger.log("[TournamentDetailsPage] Full refetch successful: " + message));
                        });
                    });
                });
            };
            throw new Error("Failed pattern match at Component.TournamentDetailsPage (line 343, column 16 - line 392, column 88): " + [ v.constructor.name ]);
        };
    };
};
var initialState = function (input) {
    return {
        tournamentId: input.tournamentId,
        tournament: Data_Maybe.Nothing.value,
        loading: true,
        error: Data_Maybe.Nothing.value,
        userId: Data_Maybe.Nothing.value,
        theme: Config_Themes.getTheme("scrabble"),
        editing: false,
        editForm: emptyEditForm,
        pollingDays: 4
    };
};
var component = function (dictMonadBackend) {
    var handleAction1 = handleAction(dictMonadBackend);
    return function (dictMonadEffect) {
        return Halogen_Component.mkComponent({
            initialState: initialState,
            render: render,
            "eval": Halogen_Component.mkEval({
                handleQuery: Halogen_Component.defaultEval.handleQuery,
                receive: Halogen_Component.defaultEval.receive,
                finalize: Halogen_Component.defaultEval.finalize,
                handleAction: handleAction1(dictMonadEffect),
                initialize: new Data_Maybe.Just(Initialize.value)
            })
        });
    };
};
export {
    Initialize,
    LoadTournament,
    HandleBackClick,
    HandleEditClick,
    HandleSaveClick,
    HandleCancelClick,
    HandleFieldChange,
    HandlePollingDaysChange,
    HandleStartPolling,
    HandleStopPolling,
    HandleClearCache,
    HandleRefetch,
    HandleFullRefetch,
    Name,
    LongFormName,
    City,
    Year,
    Lexicon,
    ThemeField,
    DataUrl,
    NavigateBack,
    component,
    initialState,
    emptyEditForm,
    render,
    renderTournamentDetails,
    renderPollingSection,
    renderControlSection,
    formatDateString,
    updateField,
    renderThemeSection,
    renderFieldOrInput,
    handleAction,
    handleEditClick,
    handleSaveClick,
    handleLoadTournament,
    handleStartPolling,
    handleStopPolling
};

// Generated by purs version 0.15.15
import * as Affjax from "../Affjax/index.js";
import * as Affjax_RequestBody from "../Affjax.RequestBody/index.js";
import * as Affjax_ResponseFormat from "../Affjax.ResponseFormat/index.js";
import * as Affjax_Web from "../Affjax.Web/index.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Argonaut_Decode_Class from "../Data.Argonaut.Decode.Class/index.js";
import * as Data_Argonaut_Decode_Combinators from "../Data.Argonaut.Decode.Combinators/index.js";
import * as Data_Argonaut_Decode_Error from "../Data.Argonaut.Decode.Error/index.js";
import * as Data_Argonaut_Encode_Class from "../Data.Argonaut.Encode.Class/index.js";
import * as Data_Bifunctor from "../Data.Bifunctor/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var lmap = /* #__PURE__ */ Data_Bifunctor.lmap(Data_Bifunctor.bifunctorEither);
var decodeForeignObject = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeForeignObject(Data_Argonaut_Decode_Class.decodeJsonJson);
var decodeJson = /* #__PURE__ */ Data_Argonaut_Decode_Class.decodeJson(decodeForeignObject);
var getField = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonBoolean);
var getField1 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(decodeForeignObject);
var getField2 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonString);
var getField3 = /* #__PURE__ */ Data_Argonaut_Decode_Combinators.getField(Data_Argonaut_Decode_Class.decodeJsonInt);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Either.applicativeEither);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var gEncodeJsonCons = /* #__PURE__ */ Data_Argonaut_Encode_Class.gEncodeJsonCons(Data_Argonaut_Encode_Class.encodeJsonJString);
var encodeJson = /* #__PURE__ */ Data_Argonaut_Encode_Class.encodeJson(/* #__PURE__ */ Data_Argonaut_Encode_Class.encodeRecord(/* #__PURE__ */ gEncodeJsonCons(/* #__PURE__ */ gEncodeJsonCons(Data_Argonaut_Encode_Class.gEncodeJsonNil)({
    reflectSymbol: function () {
        return "username";
    }
})())({
    reflectSymbol: function () {
        return "password";
    }
})())());
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var decodeLoginResponse = function (json) {
    return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(decodeJson(json)))(function (obj) {
        return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField(obj)("success")))(function (success) {
            if (success) {
                return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField1(obj)("data")))(function (data_) {
                    return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField2(data_)("token")))(function (token) {
                        return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField1(data_)("user")))(function (user) {
                            return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField3(user)("id")))(function (userId) {
                                return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField2(user)("username")))(function (username) {
                                    return pure({
                                        token: token,
                                        userId: userId,
                                        username: username
                                    });
                                });
                            });
                        });
                    });
                });
            };
            return bind(lmap(Data_Argonaut_Decode_Error.printJsonDecodeError)(getField2(obj)("error")))(function (error) {
                return new Data_Either.Left(error);
            });
        });
    });
};
var login = function (credentials) {
    return bind1(Affjax_Web.post(Affjax_ResponseFormat.json)("http://localhost:3001/api/auth/login")(new Data_Maybe.Just(Affjax_RequestBody.json(encodeJson(credentials)))))(function (result) {
        if (result instanceof Data_Either.Left) {
            return pure1(new Data_Either.Left("Network error: " + Affjax.printError(result.value0)));
        };
        if (result instanceof Data_Either.Right) {
            return pure1(decodeLoginResponse(result.value0.body));
        };
        throw new Error("Failed pattern match at API.Auth (line 52, column 3 - line 54, column 63): " + [ result.constructor.name ]);
    });
};
export {
    decodeLoginResponse,
    login
};

// Generated by purs version 0.15.15
import * as CSS_Class from "../CSS.Class/index.js";
import * as CSS_ThemeColor from "../CSS.ThemeColor/index.js";
import * as Component_Overlay_BaseOverlay from "../Component.Overlay.BaseOverlay/index.js";
import * as Control_Alt from "../Control.Alt/index.js";
import * as Control_Alternative from "../Control.Alternative/index.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Newtype from "../Data.Newtype/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Utils_CSS from "../Utils.CSS/index.js";
import * as Utils_Format from "../Utils.Format/index.js";
import * as Utils_PlayerImage from "../Utils.PlayerImage/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Data_Maybe.bindMaybe);
var guard = /* #__PURE__ */ Control_Alternative.guard(Data_Maybe.alternativeMaybe);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Maybe.applicativeMaybe);
var unwrap = /* #__PURE__ */ Data_Newtype.unwrap();
var alt = /* #__PURE__ */ Control_Alt.alt(Data_Maybe.altMaybe);
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var resolvePlayerId = function (playerIdParam) {
    return function (maybeCurrentMatch) {
        return function (games) {
            var fromCurrentMatch = bind(maybeCurrentMatch)(function (currentMatch) {
                return discard(guard(playerIdParam === 1 || playerIdParam === 2))(function () {
                    return bind(Data_Array.find(function (g) {
                        return Data_Maybe.maybe(false)(function (v) {
                            return v === currentMatch.pairingId;
                        })(g.pairingId) && g.roundNumber === currentMatch.round;
                    })(games))(function (game) {
                        return pure(unwrap((function () {
                            var $28 = playerIdParam === 1;
                            if ($28) {
                                return game.player1Id;
                            };
                            return game.player2Id;
                        })()));
                    });
                });
            });
            return alt(fromCurrentMatch)(pure(playerIdParam));
        };
    };
};
var renderStatBox = function (theme) {
    return function (label) {
        return function (value) {
            return function (useMono) {
                return function (colSpan2) {
                    return Halogen_HTML_Elements.div([ Utils_CSS.css(append([ Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.cls(CSS_Class.RoundedXl.value), Utils_CSS.cls(CSS_Class.P_3.value), Utils_CSS.cls(CSS_Class.Border.value), Utils_CSS.thm(theme)(CSS_ThemeColor.SecondaryBorder.value) ])((function () {
                        if (colSpan2) {
                            return [ Utils_CSS.cls(CSS_Class.ColSpan_2.value) ];
                        };
                        return [  ];
                    })())) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Text_Base.value), Utils_CSS.cls(CSS_Class.FontBold.value), Utils_CSS.cls(CSS_Class.Uppercase.value), Utils_CSS.cls(CSS_Class.TrackingWider.value), Utils_CSS.cls(CSS_Class.Mb_1.value) ]) ])([ Halogen_HTML_Core.text(label) ]), Halogen_HTML_Elements.div([ Utils_CSS.css(append([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value), Utils_CSS.cls(CSS_Class.Text_3xl.value), Utils_CSS.cls(CSS_Class.FontBlack.value) ])((function () {
                        if (useMono) {
                            return [ Utils_CSS.cls(CSS_Class.FontMono.value) ];
                        };
                        return [  ];
                    })())) ])([ Halogen_HTML_Core.text(value) ]) ]);
                };
            };
        };
    };
};
var renderStatsGrid = function (theme) {
    return function (profileData) {
        var tournamentBox = (function () {
            if (profileData.tournamentCount instanceof Data_Maybe.Just) {
                return [ renderStatBox(theme)("Tournaments")(show(profileData.tournamentCount.value0))(false)(false) ];
            };
            if (profileData.tournamentCount instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 182, column 21 - line 184, column 20): " + [ profileData.tournamentCount.constructor.name ]);
        })();
        var recordBoxes = (function () {
            if (profileData.wins instanceof Data_Maybe.Just && (profileData.losses instanceof Data_Maybe.Just && profileData.ties instanceof Data_Maybe.Just)) {
                return [ renderStatBox(theme)("Career Record")(show(profileData.wins.value0) + ("-" + (show(profileData.losses.value0) + ("-" + show(profileData.ties.value0)))))(true)(false), (function () {
                    if (profileData.winPercentage instanceof Data_Maybe.Just) {
                        return renderStatBox(theme)("Career Win %")(Utils_Format.formatNumber(profileData.winPercentage.value0)(1) + "%")(false)(false);
                    };
                    if (profileData.winPercentage instanceof Data_Maybe.Nothing) {
                        return Halogen_HTML_Core.text("");
                    };
                    throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 189, column 11 - line 191, column 34): " + [ profileData.winPercentage.constructor.name ]);
                })() ];
            };
            return [  ];
        })();
        var ratingBox = (function () {
            if (profileData.rating instanceof Data_Maybe.Just) {
                return [ renderStatBox(theme)("Rating")(show(profileData.rating.value0))(false)(false) ];
            };
            if (profileData.rating instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 174, column 17 - line 176, column 20): " + [ profileData.rating.constructor.name ]);
        })();
        var rankingBox = (function () {
            if (profileData.ranking instanceof Data_Maybe.Just) {
                return [ renderStatBox(theme)("Ranking")(show(profileData.ranking.value0))(false)(false) ];
            };
            if (profileData.ranking instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 178, column 18 - line 180, column 20): " + [ profileData.ranking.constructor.name ]);
        })();
        var avgScoreBox = (function () {
            if (profileData.averageScore instanceof Data_Maybe.Just) {
                var shouldSpan = Data_Maybe.isNothing(profileData.ranking);
                var scoreText = (function () {
                    if (profileData.opponentAvgScore instanceof Data_Maybe.Just) {
                        return show(Data_Int.round(Data_Int.toNumber(profileData.averageScore.value0))) + ("-" + show(Data_Int.round(Data_Int.toNumber(profileData.opponentAvgScore.value0))));
                    };
                    if (profileData.opponentAvgScore instanceof Data_Maybe.Nothing) {
                        return show(Data_Int.round(Data_Int.toNumber(profileData.averageScore.value0)));
                    };
                    throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 197, column 25 - line 199, column 61): " + [ profileData.opponentAvgScore.constructor.name ]);
                })();
                return [ renderStatBox(theme)("Average Score")(scoreText)(true)(shouldSpan) ];
            };
            if (profileData.averageScore instanceof Data_Maybe.Nothing) {
                return [  ];
            };
            throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 195, column 19 - line 203, column 20): " + [ profileData.averageScore.constructor.name ]);
        })();
        return append(ratingBox)(append(rankingBox)(append(tournamentBox)(append(recordBoxes)(avgScoreBox))));
    };
};
var renderRecentTournament = function (theme) {
    return function (result) {
        var isWin = result.place === 1;
        return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Mt_5.value), Utils_CSS.cls(CSS_Class.P_4.value), Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.cls(CSS_Class.RoundedXl.value), Utils_CSS.cls(CSS_Class.Border.value), Utils_CSS.thm(theme)(CSS_ThemeColor.PrimaryBorder.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontBold.value), Utils_CSS.cls(CSS_Class.Mb_2.value) ]) ])([ Halogen_HTML_Core.text((function () {
            if (isWin) {
                return "\ud83c\udfc6 Recent Tournament Win";
            };
            return "Recent Tournament";
        })()) ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value), Utils_CSS.cls(CSS_Class.Text_2xl.value), Utils_CSS.cls(CSS_Class.FontBold.value), Utils_CSS.cls(CSS_Class.Mb_3.value) ]) ])([ Halogen_HTML_Core.text(result.name) ]), Halogen_HTML_Elements.table_([ Halogen_HTML_Elements.tbody_([ Halogen_HTML_Elements.tr_([ Halogen_HTML_Elements.td([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontSemibold.value), Utils_CSS.cls(CSS_Class.Opacity_70.value), Utils_CSS.cls(CSS_Class.Pr_3.value), Utils_CSS.cls(CSS_Class.AlignTop.value), Utils_CSS.cls(CSS_Class.WhitespaceNowrap.value) ]) ])([ Halogen_HTML_Core.text("Date:") ]), Halogen_HTML_Elements.td([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontBold.value) ]) ])([ Halogen_HTML_Core.text(Utils_Format.formatDate(result.date)) ]) ]), Halogen_HTML_Elements.tr_([ Halogen_HTML_Elements.td([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontSemibold.value), Utils_CSS.cls(CSS_Class.Opacity_70.value), Utils_CSS.cls(CSS_Class.Pr_3.value), Utils_CSS.cls(CSS_Class.AlignTop.value), Utils_CSS.cls(CSS_Class.WhitespaceNowrap.value) ]) ])([ Halogen_HTML_Core.text("Record:") ]), Halogen_HTML_Elements.td([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value), Utils_CSS.cls(CSS_Class.FontMono.value), Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontBold.value) ]) ])([ Halogen_HTML_Core.text(show(result.wins) + ("-" + show(result.losses))) ]) ]) ]) ]) ]);
    };
};
var prepareProfileData = function (player) {
    return {
        location: Utils_Format.formatLocation(player.xtData),
        rating: Utils_Format.getCurrentRating({
            initialRating: player.initialRating,
            ratingsHistory: player.ratingsHistory
        }),
        ranking: Utils_Format.getRanking(player.xtData),
        winPercentage: Utils_Format.calculateWinPercentage(player.xtData),
        tournamentCount: Data_Maybe.maybe(Data_Maybe.Nothing.value)(function (v) {
            return v.tournamentCount;
        })(player.xtData),
        averageScore: Data_Maybe.maybe(Data_Maybe.Nothing.value)(function (v) {
            return v.averageScore;
        })(player.xtData),
        opponentAvgScore: Data_Maybe.maybe(Data_Maybe.Nothing.value)(function (v) {
            return v.opponentAverageScore;
        })(player.xtData),
        recentTournament: Utils_Format.getRecentTournament(player.xtData),
        wins: bind(player.xtData)(function (v) {
            return v.w;
        }),
        losses: bind(player.xtData)(function (v) {
            return v.l;
        }),
        ties: bind(player.xtData)(function (v) {
            return v.t;
        })
    };
};
var preparePlayerImageData = function (player) {
    return function (tournament) {
        var xtPhotoUrl = bind(player.xtData)(function (v) {
            return v.photourl;
        });
        var imageUrl = Utils_PlayerImage.getPlayerImageUrl(tournament.dataUrl)(player.photo)(xtPhotoUrl);
        return {
            imageUrl: imageUrl,
            altText: player.name
        };
    };
};
var renderPlayerImage = function (player) {
    return function (tournament) {
        var imageData = preparePlayerImageData(player)(tournament);
        return Halogen_HTML_Elements.img([ Halogen_HTML_Properties.src(imageData.imageUrl), Halogen_HTML_Properties.alt(imageData.altText), Utils_CSS.css([ Utils_CSS.cls(CSS_Class.W_40.value), Utils_CSS.cls(CSS_Class.H_40.value), Utils_CSS.cls(CSS_Class.Rounded_2xl.value), Utils_CSS.cls(CSS_Class.ObjectCover.value), Utils_CSS.cls(CSS_Class.Border_2.value), Utils_CSS.raw("border-blue-400/50"), Utils_CSS.cls(CSS_Class.ShadowLg.value) ]) ]);
    };
};
var renderPlayerProfile = function (theme) {
    return function (player) {
        return function (tournament) {
            var profileData = prepareProfileData(player);
            return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.PageBackground.value), Utils_CSS.cls(CSS_Class.MinHScreen.value), Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.ItemsCenter.value), Utils_CSS.cls(CSS_Class.JustifyCenter.value), Utils_CSS.cls(CSS_Class.P_6.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.thm(theme)(CSS_ThemeColor.CardBackground.value), Utils_CSS.cls(CSS_Class.Rounded_3xl.value), Utils_CSS.cls(CSS_Class.P_8.value), Utils_CSS.cls(CSS_Class.Border_2.value), Utils_CSS.thm(theme)(CSS_ThemeColor.PrimaryBorder.value), Utils_CSS.cls(CSS_Class.Shadow_2xl.value), Utils_CSS.thm(theme)(CSS_ThemeColor.ShadowColor.value), Utils_CSS.raw("min-w-[32rem]") ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Flex.value), Utils_CSS.cls(CSS_Class.Gap_8.value) ]) ])([ Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FlexShrink_0.value) ]) ])([ renderPlayerImage(player)(tournament), (function () {
                if (profileData.location instanceof Data_Maybe.Just) {
                    return Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Text_Xl.value), Utils_CSS.cls(CSS_Class.FontBold.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextAccent.value), Utils_CSS.cls(CSS_Class.Mt_4.value), Utils_CSS.cls(CSS_Class.TextCenter.value) ]) ])([ Halogen_HTML_Core.text(profileData.location.value0) ]);
                };
                if (profileData.location instanceof Data_Maybe.Nothing) {
                    return Halogen_HTML_Core.text("");
                };
                throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 135, column 21 - line 140, column 44): " + [ profileData.location.constructor.name ]);
            })() ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.FlexGrow.value) ]) ])([ Halogen_HTML_Elements.h2([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Text_5xl.value), Utils_CSS.cls(CSS_Class.FontBlack.value), Utils_CSS.cls(CSS_Class.Mb_3.value), Utils_CSS.thm(theme)(CSS_ThemeColor.TextPrimary.value) ]) ])([ Halogen_HTML_Core.text(Utils_Format.formatPlayerName(player.name)) ]), Halogen_HTML_Elements.div([ Utils_CSS.css([ Utils_CSS.cls(CSS_Class.Grid.value), Utils_CSS.cls(CSS_Class.GridCols_2.value), Utils_CSS.cls(CSS_Class.Gap_6.value) ]) ])(renderStatsGrid(theme)(profileData)), (function () {
                if (profileData.recentTournament instanceof Data_Maybe.Just) {
                    return renderRecentTournament(theme)(profileData.recentTournament.value0);
                };
                if (profileData.recentTournament instanceof Data_Maybe.Nothing) {
                    return Halogen_HTML_Core.text("");
                };
                throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 152, column 21 - line 154, column 44): " + [ profileData.recentTournament.constructor.name ]);
            })() ]) ]) ]) ]);
        };
    };
};
var findPlayerByParam = function (playerIdParam) {
    return function (currentMatch) {
        return function (games) {
            return function (players) {
                return bind(resolvePlayerId(playerIdParam)(currentMatch)(games))(function (actualId) {
                    return Data_Array.find(function (p) {
                        return unwrap(p.id) === actualId;
                    })(players);
                });
            };
        };
    };
};
var render = function (state) {
    return Component_Overlay_BaseOverlay.renderWithData(state)(function (tournamentData) {
        var maybePlayer = findPlayerByParam(state.extra)(state.currentMatch)(tournamentData.division.games)(tournamentData.division.players);
        if (maybePlayer instanceof Data_Maybe.Nothing) {
            return Component_Overlay_BaseOverlay.renderError("Player " + (show(state.extra) + " not found in division"));
        };
        if (maybePlayer instanceof Data_Maybe.Just) {
            return renderPlayerProfile(state.theme)(maybePlayer.value0)(tournamentData.tournament);
        };
        throw new Error("Failed pattern match at Component.Overlay.CrossTablesPlayerProfile (line 116, column 7 - line 118, column 88): " + [ maybePlayer.constructor.name ]);
    });
};
var component = function (dictMonadAff) {
    var mkComponent = Component_Overlay_BaseOverlay.mkComponent(dictMonadAff);
    return function (dictMonadBroadcast) {
        var mkComponent1 = mkComponent(dictMonadBroadcast);
        return function (dictMonadEmitters) {
            return mkComponent1(dictMonadEmitters)(render);
        };
    };
};
export {
    resolvePlayerId,
    findPlayerByParam,
    prepareProfileData,
    preparePlayerImageData,
    component,
    render,
    renderPlayerProfile,
    renderPlayerImage,
    renderStatsGrid,
    renderStatBox,
    renderRecentTournament
};

// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Domain_Types from "../Domain.Types/index.js";
import * as Utils_Format from "../Utils.Format/index.js";
var eq = /* #__PURE__ */ Data_Eq.eq(Domain_Types.eqPlayerId);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var compare1 = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordNumber);
var getRecentGamesForPlayer = function (playerId) {
    return function (games) {
        return function (limit) {
            var playerGames = Data_Array.filter(function (g) {
                return eq(g.player1Id)(playerId) || eq(g.player2Id)(playerId);
            })(games);
            var playedGames = Data_Array.filter(function (g) {
                return Data_Maybe.maybe(false)(Data_Function["const"](true))(g.player1Score) && Data_Maybe.maybe(false)(Data_Function["const"](true))(g.player2Score);
            })(playerGames);
            var sortedGames = Data_Array.sortBy(function (a) {
                return function (b) {
                    return compare(b.roundNumber)(a.roundNumber);
                };
            })(playedGames);
            return Data_Array.take(limit)(sortedGames);
        };
    };
};
var getPlaceOrSeedLabel = function (player) {
    var $17 = player.wins === 0 && player.losses === 0;
    if ($17) {
        return "Seed";
    };
    return "Place";
};
var getOpponentName = function (playerId) {
    return function (game) {
        return function (players) {
            var opponentId = (function () {
                var $18 = eq(game.player1Id)(playerId);
                if ($18) {
                    return game.player2Id;
                };
                return game.player1Id;
            })();
            var maybeOpponent = Data_Array.find(function (p) {
                return eq(p.playerId)(opponentId);
            })(players);
            return Data_Maybe.maybe("Unknown")(function (v) {
                return v.name;
            })(maybeOpponent);
        };
    };
};
var gameResult = function (pid) {
    return function (game) {
        var isPlayer1 = eq(game.player1Id)(pid);
        var opponentScore = (function () {
            if (isPlayer1) {
                return game.player2Score;
            };
            return game.player1Score;
        })();
        var playerScore = (function () {
            if (isPlayer1) {
                return game.player1Score;
            };
            return game.player2Score;
        })();
        if (playerScore instanceof Data_Maybe.Just && opponentScore instanceof Data_Maybe.Just) {
            var $23 = playerScore.value0 > opponentScore.value0;
            if ($23) {
                return "W";
            };
            var $24 = playerScore.value0 === opponentScore.value0;
            if ($24) {
                return "T";
            };
            return "L";
        };
        return "?";
    };
};
var formatRecord = function (player) {
    return show(player.wins) + ("-" + (show(player.losses) + (function () {
        var $27 = player.ties > 0;
        if ($27) {
            return "-" + show(player.ties);
        };
        return "";
    })()));
};
var formatUnderCamRecord = function (player) {
    return formatRecord(player) + (" " + Utils_Format.formatNumberWithSign(player.spread));
};
var formatUnderCamNoSeed = function (player) {
    var rankOrd = Utils_Format.formatRankOrdinal(player.rank);
    var label = getPlaceOrSeedLabel(player);
    return formatUnderCamRecord(player) + (" | " + (rankOrd + (" " + label)));
};
var formatUnderCamWithRating = function (player) {
    var rankOrd = Utils_Format.formatRankOrdinal(player.rank);
    var label = getPlaceOrSeedLabel(player);
    return formatUnderCamRecord(player) + (" | " + (rankOrd + (" " + (label + (" | Rating " + show(player.currentRating))))));
};
var formatGameHistorySimple = function (playerId) {
    return function (games) {
        var recentGames = getRecentGamesForPlayer(playerId)(games)(5);
        var results = map(gameResult(playerId))(recentGames);
        var chronologicalResults = Data_Array.reverse(results);
        var $28 = Data_Array["null"](results);
        if ($28) {
            return "No games";
        };
        return "Last " + (show(Data_Array.length(results)) + (": " + Data_String_Common.joinWith("-")(chronologicalResults)));
    };
};
var formatFullUnderCam = function (player) {
    var seedOrd = Utils_Format.formatRankOrdinal(player.seed);
    var recordPart = formatUnderCamRecord(player);
    var rankOrd = Utils_Format.formatRankOrdinal(player.rank);
    var label = getPlaceOrSeedLabel(player);
    var $29 = label === "Seed";
    if ($29) {
        return recordPart + (" | " + (rankOrd + " Seed"));
    };
    return recordPart + (" | " + (rankOrd + (" Place (" + (seedOrd + " Seed)"))));
};
var formatBestOf7 = function (player) {
    return "Best of 7 Record: " + formatUnderCamRecord(player);
};
var calculateAverageScoreRank = function (allPlayers) {
    return function (player) {
        var sorted = Data_Array.sortBy(function (a) {
            return function (b) {
                return compare1(b.averageScore)(a.averageScore);
            };
        })(allPlayers);
        var maybeIndex = Data_Array.find(function (p) {
            return eq(p.playerId)(player.playerId);
        })(sorted);
        return Data_Maybe.maybe(1)(function (v) {
            var idx = Data_Array.length(Data_Array.filter(function (p) {
                return p.averageScore > player.averageScore;
            })(sorted));
            return idx + 1 | 0;
        })(maybeIndex);
    };
};
var calculateAverageOpponentScoreRank = function (allPlayers) {
    return function (player) {
        var sorted = Data_Array.sortBy(function (a) {
            return function (b) {
                return compare1(a.averageOpponentScore)(b.averageOpponentScore);
            };
        })(allPlayers);
        var maybeIndex = Data_Array.find(function (p) {
            return eq(p.playerId)(player.playerId);
        })(sorted);
        return Data_Maybe.maybe(1)(function (v) {
            var idx = Data_Array.length(Data_Array.filter(function (p) {
                return p.averageOpponentScore < player.averageOpponentScore;
            })(sorted));
            return idx + 1 | 0;
        })(maybeIndex);
    };
};
export {
    formatRecord,
    getPlaceOrSeedLabel,
    formatUnderCamRecord,
    formatFullUnderCam,
    formatUnderCamNoSeed,
    formatUnderCamWithRating,
    formatBestOf7,
    getRecentGamesForPlayer,
    gameResult,
    formatGameHistorySimple,
    getOpponentName,
    calculateAverageScoreRank,
    calculateAverageOpponentScoreRank
};
